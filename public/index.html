<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <style>
  select {
    width: 300px;
  }
  .boxWrapper {
    border: 1px dotted black;
    padding: 10px;
    width: 900px;
    text-align: center;
    margin-bottom: 2px;
  }
  table {
    width: 98%;
  }
  table td {
    border: 1px solid black
  }
  .columns {
    margin-bottom: 4px;
  }
  </style>
</head>

<body>
  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

  <html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="generator" content=
    "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org" />

    <title></title>
  </head>

  <body>
    <div class="boxWrapper">
      <h3>1) Choose a brand:</h3>
      <div class="columns">
        <div class="wrap_select">
          <select name="" class="brand_select hasCustomSelect">
            <option value="">
              choose... store
            </option>

            <option value="ALEXANDERMCQUEEN">
              AMQ
            </option>

            <option value="MCQ">
              MCQ
            </option>

            <option value="BALENCIAGA">
              BAL
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="boxWrapper">
      <div class="columns">
        <h3>2) Choose a gender:</h3>

        <div class="wrap_select">
          <select name="" class="gender_select hasCustomSelect">
            <option value="">
              choose... gender
            </option>

            <option value="D">
              Women
            </option>

            <option value="U">
              Man
            </option>

            <option value="X">
              Unisex
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="boxWrapper">
      <div class="columns">
        <h3>2) Choose a language:</h3>

        <div class="wrap_select">
          <select name="" class="language_select hasCustomSelect">
            <option value="">
              choose... language
            </option>

            <option value="it">
              Italian
            </option>

            <option value="en">
              English UK
            </option>

            <option value="fr">
              French
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="countriesWrapper boxWrapper">
      <h3>3) Choose a nation:</h3>

      <div class="columns europe">
        <div class="wrap_select">
          <select name="" class="cyc_select hasCustomSelect">
            <option value="">
              Europe
            </option>

            <option value="al">
              Albania
            </option>

            <option value="ad">
              Andorra
            </option>

            <option value="at">
              Austria
            </option>

            <option value="by">
              Belarus
            </option>

            <option value="be">
              Belgium
            </option>

            <option value="ba">
              Bosnia and Herzegovina
            </option>

            <option value="bg">
              Bulgaria
            </option>

            <option value="hr">
              Croatia
            </option>

            <option value="cy">
              Cyprus
            </option>

            <option value="cz">
              Czech Republic
            </option>

            <option value="dk">
              Denmark
            </option>

            <option value="ee">
              Estonia
            </option>

            <option value="fi">
              Finland
            </option>

            <option value="fr">
              France
            </option>

            <option value="de">
              Germany
            </option>

            <option value="gr">
              Greece
            </option>

            <option value="va">
              Holy See (Vatican City State)
            </option>

            <option value="hu">
              Hungary
            </option>

            <option value="is">
              Iceland
            </option>

            <option value="ie">
              Ireland
            </option>

            <option value="it">
              Italy
            </option>

            <option value="lv">
              Latvia
            </option>

            <option value="li">
              Liechtenstein
            </option>

            <option value="lt">
              Lithuania
            </option>

            <option value="lu">
              Luxembourg
            </option>

            <option value="mk">
              Macedonia
            </option>

            <option value="mt">
              Malta
            </option>

            <option value="md">
              Moldova, Republic of
            </option>

            <option value="mc">
              Monaco
            </option>

            <option value="me">
              Montenegro
            </option>

            <option value="nl">
              Netherlands
            </option>

            <option value="no">
              Norway
            </option>

            <option value="pl">
              Poland
            </option>

            <option value="pt">
              Portugal
            </option>

            <option value="ro">
              Romania
            </option>

            <option value="ru">
              Russian Federation
            </option>

            <option value="sm">
              San Marino
            </option>

            <option value="rs">
              Serbia
            </option>

            <option value="sk">
              Slovakia
            </option>

            <option value="si">
              Slovenia
            </option>

            <option value="es">
              Spain
            </option>

            <option value="se">
              Sweden
            </option>

            <option value="ua">
              Ukraine
            </option>

            <option value="gb">
              United Kingdom
            </option>
          </select>
        </div>
      </div>

      <div class="columns america">
        <div class="wrap_select">
          <select name="" class="cyc_select hasCustomSelect">
            <option value="">
              America
            </option>

            <option value="ar">
              Argentina
            </option>

            <option value="ca">
              Canada
            </option>

            <option value="cl">
              Chile
            </option>

            <option value="co">
              Colombia
            </option>

            <option value="do">
              Dominican Republic
            </option>

            <option value="gt">
              Guatemala
            </option>

            <option value="mx">
              Mexico
            </option>

            <option value="pa">
              Panama
            </option>

            <option value="py">
              Paraguay
            </option>

            <option value="pe">
              Peru
            </option>

            <option value="sr">
              Suriname
            </option>

            <option value="us">
              United States
            </option>

            <option value="ve">
              Venezuela
            </option>
          </select>
        </div>
      </div>

      <div class="columns asia">
        <div class="wrap_select">
          <select name="" class="cyc_select hasCustomSelect">
            <option value="">
              Asia
            </option>

            <option value="am">
              Armenia
            </option>

            <option value="az">
              Azerbaijan
            </option>

            <option value="bh">
              Bahrain
            </option>

            <option value="bn">
              Brunei Darussalam
            </option>

            <option value="cn">
              China
            </option>

            <option value="ge">
              Georgia
            </option>

            <option value="hk">
              Hong Kong
            </option>

            <option value="in">
              India
            </option>

            <option value="id">
              Indonesia
            </option>

            <option value="il">
              Israel
            </option>

            <option value="jp">
              Japan
            </option>

            <option value="jo">
              Jordan
            </option>

            <option value="kz">
              Kazakhstan
            </option>

            <option value="kw">
              Kuwait
            </option>

            <option value="kg">
              Kyrgyzstan
            </option>

            <option value="lb">
              Lebanon
            </option>

            <option value="mo">
              Macau
            </option>

            <option value="my">
              Malaysia
            </option>

            <option value="om">
              Oman
            </option>

            <option value="ph">
              Philippines
            </option>

            <option value="qa">
              Qatar
            </option>

            <option value="sa">
              Saudi Arabia
            </option>

            <option value="sg">
              Singapore
            </option>

            <option value="kr">
              South Korea
            </option>

            <option value="sy">
              Syrian Arab Republic
            </option>

            <option value="tw">
              Taiwan
            </option>

            <option value="tj">
              Tajikistan
            </option>

            <option value="th">
              Thailand
            </option>

            <option value="tr">
              Turkey
            </option>

            <option value="tm">
              Turkmenistan
            </option>

            <option value="ae">
              United Arab Emirates
            </option>

            <option value="uz">
              Uzbekistan
            </option>

            <option value="vn">
              Vietnam
            </option>
          </select>
        </div>
      </div>

      <div class="columns africa">
        <div class="wrap_select">
          <select name="" class="cyc_select hasCustomSelect">
            <option value="">
              Africa
            </option>

            <option value="dz">
              Algeria
            </option>

            <option value="ci">
              C&ocirc;te D'ivoire (Ivory Coast)
            </option>

            <option value="eg">
              Egypt
            </option>

            <option value="lr">
              Liberia
            </option>

            <option value="mg">
              Madagascar
            </option>

            <option value="ma">
              Morocco
            </option>

            <option value="za">
              South Africa
            </option>

            <option value="tn">
              Tunisia
            </option>
          </select>
        </div>
      </div>

      <div class="columns oceania">
        <div class="wrap_select">
          <select name="" class="cyc_select hasCustomSelect">
            <option value="">
              Oceania
            </option>

            <option value="au">
              Australia
            </option>

            <option value="nz">
              New Zealand
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="boxWrapper">
      <h3>3) Genera i link:</h3>

      <div class="columns">
        <div class="wrap_select">
          <input type="button" value="Genera link" class="generateButton" />
        </div>
      </div>
    </div>

    <div class="boxWrapper">
      <h3>4) Links:</h3>

      <div class="columns">
        <div class="wrap_select results">
          <table>
            <tbody>
              <tr>
                <th>Dept</th>
                <th>Link</th>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
    jQuery( document ).ready(function( $ ) {

      $(".generateButton").on("click", function() {
        var brandValue = $(".brand_select").val();
        var genderValue = $(".gender_select").val();
        var nationValue = [];
        $('.countriesWrapper select').each(function() {
          if($(this).val() != "") {
            nationValue.push($(this).val().trim())
          }
        });
        if (brandValue === "") {
          alert("seleziona brand");
          return;
        }
        if (nationValue.length === 0) {
          alert("seleziona nation");
          return;
        }
        if (genderValue === "") {
          alert("seleziona gender");
          return;
        }
        var siteCodes = [];
        var siteCode = "";
        var api_url = "";

        var genderObj = {};
        var lang = "en";
        var genderForUrl;
        var urlWithoutDept;

        var url = {
          "ALEXANDERMCQUEEN": "http://www.alexandermcqueen.com/"+nationValue[0]+"/alexandermcqueen/online/",
          "BALENCIAGA": "http://www.balenciaga.com/"+nationValue[0]+"/",
          "MCQ": "http://www.mcq.com/"+nationValue[0]+"/online/",
        }

        $.ajax({
          url: "/gender.json",
          // CALLBACK I
          success: function(result) {
            result.Genders.Gender.filter(function(genderObj) {
              if (genderObj["-code"] === genderValue) {
                genderObj.Label.filter(function(genderLabel) {
                  if(genderLabel["-idLanguage"] === lang) {
                    //console.log(genderLabel.AgeRange[0]["#text"]);
                    genderForUrl = genderLabel.AgeRange[0]["#text"];
                    console.log(url[brandValue]+genderForUrl+"/");

                    urlWithoutDept = url[brandValue]+genderForUrl+"/";

                    siteCodes = nationValue.map(function(value) {
                      if(value.trim() === "") {
                        return;
                      }
                      siteCode = (value != "") ? (brandValue + "_" + value).toUpperCase() : "";
                      api_url = "/proxy/?url=http://api.yoox.biz/Cms.API/1.1/" + siteCode + "/labels/main/navigation.json";

                      $.ajax({
                        url: api_url,
                        // CALLBACK II
                        success: function(result) {
                          result.Labels.map(function(entry) {
                            $(".results table").append("<tr><td>"+entry.Key+"</td><td><a href=\""+urlWithoutDept+entry.Value+"\">"+urlWithoutDept+entry.Value+"</a></td></tr>")
                          })
                        }
                      });

                    });
                  }

                });

              }
            });
          }
        });

      });

      //PROMISE -------- * * * --------- PROMISE//

    })
    </script>
  </body>

  </html>
